<!DOCTYPE html>

<html lang="ja" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>extract_combined.py &#8212; ODAT-SE 3.1.0 ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=47202671" />
    <link rel="stylesheet" type="text/css" href="../../_static/haiku.css?v=fce32b03" />
    <script src="../../_static/documentation_options.js?v=4408be02"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=4755f45a"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="next" title="separateT.py" href="separateT.html" />
    <link rel="prev" title="plt_2D_histogram.py" href="plt_2D_histogram.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../index.html">
          <span>ODAT-SE 3.1.0 ドキュメント</span></a></h1>
        <h2 class="heading"><span>extract_combined.py</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="Top">
      
        <p>
        «&#160;&#160;<a href="plt_2D_histogram.html">plt_2D_histogram.py</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">コンテンツ</a>
        &#160;&#160;::&#160;&#160;
        <a href="separateT.html">separateT.py</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="extract-combined-py">
<h1>extract_combined.py<a class="headerlink" href="#extract-combined-py" title="Link to this heading">¶</a></h1>
<section id="name">
<h2>NAME<a class="headerlink" href="#name" title="Link to this heading">¶</a></h2>
<p>combined 形式のログファイルから特定の項目を取り出す</p>
</section>
<section id="synopsis">
<h2>SYNOPSIS<a class="headerlink" href="#synopsis" title="Link to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>extract_combined.py<span class="w"> </span><span class="o">[</span>OPTION<span class="o">]</span>...<span class="w"> </span>-t<span class="w"> </span>tag<span class="w"> </span><span class="o">[</span>FILE<span class="o">]</span>...
</pre></div>
</div>
</section>
<section id="description">
<h2>DESCRIPTION<a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>MCMC の combined 形式のログファイルから tag でタグ付けされた行を取り出す。</p>
<p>combined 形式では、行の先頭に <code class="docutils literal notranslate"><span class="pre">&lt;tag&gt;</span></code> 形式のタグを付けて複数のデータが格納されている。このファイルから特定の <code class="docutils literal notranslate"><span class="pre">tag</span></code> のついた行を取り出し、ファイルに出力する。出力ファイルは入力と同じディレクトリ内の <code class="docutils literal notranslate"><span class="pre">tag</span></code> というファイルになる。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<ul class="simple">
<li><p>Python 3.5以上が必要です(タイプヒントを使用しているため)。</p></li>
<li><p>タグの形式は <code class="docutils literal notranslate"><span class="pre">&lt;tag&gt;</span></code> の形式で、タグの後にスペースが必要です。</p></li>
</ul>
</div>
<p>指定可能なコマンドラインオプションを以下に示す。
FILE を指定した場合はそのファイルが対象となる。明示的にファイルを指定しない場合、DATA_DIR/*/combined.txt が対象となる。</p>
<dl class="simple">
<dt><strong>FILE</strong></dt><dd><p>MCMCのログファイル名(combined.txt)を指定する。複数のファイルを指定可能。</p>
</dd>
<dt><strong>-t TAG, --tag TAG</strong></dt><dd><p>取り出す項目の tag を指定する。必須パラメータ。タグは文字列型(str)。</p>
</dd>
<dt><strong>-d DATA_DIR, --data_dir DATA_DIR</strong></dt><dd><p>データファイルをディレクトリから取得する場合(<code class="docutils literal notranslate"><span class="pre">FILE</span></code> を指定しない場合)に、ディレクトリを指定する。</p>
</dd>
<dt><strong>--progress</strong></dt><dd><p>実行時にプログレスバーを表示する。表示には tqdm ライブラリが必要。tqdmがインストールされていない場合は、代わりに処理中のファイル名が表示される。</p>
</dd>
<dt><strong>-h, --help</strong></dt><dd><p>ヘルプメッセージを表示してプログラムを終了する。</p>
</dd>
</dl>
</section>
<section id="usage">
<h2>USAGE<a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p>基本的な使用方法を以下に示す。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># 特定のファイルから「energy」タグのついた行を抽出し、path/to/energy に出力</span>
python3<span class="w"> </span>extract_combined.py<span class="w"> </span>-t<span class="w"> </span>energy<span class="w"> </span>path/to/combined.txt

<span class="c1"># 特定のディレクトリ内の全combined.txtファイルから「acc」タグの行を抽出</span>
python3<span class="w"> </span>extract_combined.py<span class="w"> </span>-t<span class="w"> </span>acc<span class="w"> </span>-d<span class="w"> </span>./mcmc_results/

<span class="c1"># プログレスバーを表示しながら複数のファイルを処理</span>
python3<span class="w"> </span>extract_combined.py<span class="w"> </span>-t<span class="w"> </span>energy<span class="w"> </span>--progress<span class="w"> </span>file1.txt<span class="w"> </span>file2.txt<span class="w"> </span>file3.txt
</pre></div>
</div>
</section>
<section id="notes">
<h2>NOTES<a class="headerlink" href="#notes" title="Link to this heading">¶</a></h2>
<section id="id1">
<h3>実行時の注意点<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>タグの完全一致</strong>:
タグは完全に一致する必要がある。「energy」タグを指定した場合、「<code class="docutils literal notranslate"><span class="pre">&lt;energy&gt;</span></code>」で始まる行のみが抽出される。
「<code class="docutils literal notranslate"><span class="pre">&lt;Energy&gt;</span></code>」や「<code class="docutils literal notranslate"><span class="pre">&lt;energy_value&gt;</span></code>」などは対象外。タグの後にはスペースが必要。</p></li>
<li><p><strong>出力ファイルの上書き</strong>:
同名のファイルが既に存在する場合、警告なく上書きされる。重要なファイルがある場合は事前にバックアップを取ることを推奨。</p></li>
<li><p><strong>大規模ファイルの処理</strong>:
スクリプトは行単位で処理を行うため、非常に大きなファイルでもメモリ消費は抑えられる。
多数のファイルを処理する場合、 <code class="docutils literal notranslate"><span class="pre">--progress</span></code> オプションを使用することで進捗状況を確認できる。</p></li>
<li><p><strong>ファイル名とパスの扱い</strong>:
出力ファイル名は単純に <code class="docutils literal notranslate"><span class="pre">tag</span></code> になる。タグに不正な文字(ファイル名に使用できない文字)が含まれる場合、ファイル作成時にエラーが発生する可能性がある。</p></li>
<li><p><strong>空のファイル処理</strong>:
入力ファイルが空の場合や、指定されたタグが一つも見つからない場合、空のファイルが生成される。</p></li>
</ol>
</section>
<section id="combined">
<h3>combined形式のファイル構造<a class="headerlink" href="#combined" title="Link to this heading">¶</a></h3>
<p>combined形式のファイルは以下のような構造を持つ:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>&lt;tag1&gt; value1 value2 ...
&lt;tag2&gt; value3 value4 ...
&lt;tag1&gt; value5 value6 ...
...
</pre></div>
</div>
<p>各行の先頭に <code class="docutils literal notranslate"><span class="pre">&lt;tag&gt;</span></code> の形式でタグが付けられており、<code class="docutils literal notranslate"><span class="pre">extract_combined.py</span></code> はこのタグを検索して一致する行を抽出する。
タグ部分は出力ファイルからは削除される。</p>
</section>
<section id="id2">
<h3>一般的なワークフロー<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h3>
<p>このスクリプトは、MCMCシミュレーションの結果を分析する際に使用する:</p>
<ol class="arabic simple">
<li><p>export_combined_files オプションを有効にしてMCMCシミュレーションを実行した場合、 <code class="docutils literal notranslate"><span class="pre">combined.txt</span></code> ファイルが出力される。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extract_combined.py</span></code> を使用して必要なファイルを抽出する。</p></li>
<li><p>抽出したデータファイルを別のツールで分析やプロットする。</p></li>
</ol>
<p>複数のシミュレーション結果を一括処理する場合は、 <code class="docutils literal notranslate"><span class="pre">-d</span></code> オプションと <code class="docutils literal notranslate"><span class="pre">--progress</span></code> オプションを組み合わせると効率的。</p>
<dl class="simple">
<dt>MCMCシミュレーションで一般的に使用されるタグの例:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">trial.txt</span></code>: Monte Carlo の tiral step のログ</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result.txt</span></code>: Monte Carlo の各ステップのログ</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">weight.txt</span></code>: PAMC計算でのウェイト値</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">time.txt</span></code>: 計算時間</p></li>
</ul>
</dd>
</dl>
</section>
<section id="id3">
<h3>エラー処理と出力<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>指定したタグが見つからない場合: 空のファイルが生成される</p></li>
<li><p>入力ファイルが読み取れない場合: エラーメッセージが標準エラー出力に表示される</p></li>
<li><p>出力ファイルが書き込めない場合: 権限エラーが標準エラー出力に表示される</p></li>
</ul>
<p>スクリプトは処理の進捗状況を標準出力に表示する。 <code class="docutils literal notranslate"><span class="pre">--progress</span></code> オプションを指定し、tqdmライブラリがインストールされている場合はプログレスバーが表示される。それ以外の場合は、処理中のファイル名が表示される。</p>
</section>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="Bottom">
      
        <p>
        «&#160;&#160;<a href="plt_2D_histogram.html">plt_2D_histogram.py</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">コンテンツ</a>
        &#160;&#160;::&#160;&#160;
        <a href="separateT.html">separateT.py</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; 著作権 2020, Institute for Solid State Physics, University of Tokyo.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>