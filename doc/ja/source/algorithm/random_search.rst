ランダム探索 ``random_search``
******************************

``random_search`` はパラメータ空間をランダムに探索し、:math:`f(x)` の最小値を探索するアルゴリズムです。高次元問題など、グリッドサーチなどの他の手法が困難なときに有効な手法です。
ランダム探索はMPI並列化に対応しており、サンプル点を各プロセスに割り振って自明並列計算を行います。
擬似乱数列に加え、Sobol列などの quasi-random sequence にも対応しています。

前準備
~~~~~~~

MPI 並列を行う場合は、 `mpi4py <https://mpi4py.readthedocs.io/en/stable/>`_ をインストールしておく必要があります。

.. code-block::

    $ python3 -m pip install mpi4py

quasi-random sequence を使う場合は `scipy <https://scipy.org>`_ をインストールしておく必要があります。

.. code-block::

    $ python3 -m pip install scipy

入力パラメータ
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. _random_search_input_algorithm:

[``algorithm``] セクション
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

- ``name``

  形式: 文字列

  説明: ランダム探索の場合は ``random_search`` と記述します。

.. _random_search_input_mode:

[``mode``] セクション
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

探索モードを定義します。このセクションを省略した場合は、擬似乱数(``random``)が指定されたものとします。

- ``mode``

  形式: 文字列

  説明: 擬似乱数列(``random``) または quasi-random sequence (``quasi-random``) を指定します。

- ``sequence``

  形式: 文字列

  説明: quasi-random sequence の場合、使用する数列のタイプを指定します。対応している数列は

  - ``sobol``: Sobol sequence

  - ``halton``: Halton sequence

  - ``latin``: Latin Hypercube

  です。詳細は scipy.stats.qmc の対応する項目の説明を参照してください。

.. _random_search_input_param:

[``param``] セクション
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

探索パラメータ空間を定義します。

- ``min_list``

  形式: 実数型のリスト。長さはdimensionの値と一致させます。

  説明: パラメータが取りうる最小値。

- ``max_list``

  形式: 実数型のリスト。長さはdimensionの値と一致させます。

  説明: パラメータが取りうる最大値。

- ``num_points``

  形式: 整数型。

  説明: ランダムサンプリングする点の数。


出力ファイル
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

``ColorMap.txt``
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

候補パラメータと、その点での目的関数の値が記載されたファイルです。

以下、出力例です。

.. code-block::

    -0.829780 2.203245 232.782783
    -4.998856 -1.976674 72748.392856
    -3.532441 -4.076614 27426.531418
    -3.137398 -1.544393 12984.994049
    -1.032325 0.388167 50.034778
    -0.808055 1.852195 147.087285
    -2.955478 3.781174 2469.533327
    -4.726124 1.704675 42598.971437
    -0.826952 0.586898 4.277709
    -3.596131 -3.018985 25465.012749
    3.007446 4.682616 1906.833520
    ...

リスタート
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
コンストラクタの引数 ``run_mode`` に実行モードを指定します。
以下はそれぞれ ``odatse`` コマンドの引数の ``--init``, ``--resume``, ``--cont`` に対応します。
各モードの動作は次のとおりです。

- ``"initial"`` (デフォルト)

  初期化して実行します。
  チェックポイント機能が有効な場合、以下のタイミングで実行時の状態をファイルに出力します。

  #. 指定した数のグリッド点を評価したとき、または指定した実行時間が経過したとき
  #. 実行の終了時

- ``"resume"``

  実行が中断した際に、最も新しいチェックポイントから実行を再開します。
  並列数などの計算条件は前と同じにする必要があります。

- ``"continue"``

  continue には対応していません。擬似乱数の場合は、seed を変えて計算することで継続実行と同等のことができます。
